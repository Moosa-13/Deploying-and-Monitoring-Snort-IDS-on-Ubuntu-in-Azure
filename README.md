## Cyber Security Project: Deploying and Monitoring Snort IDS on Ubuntu in Azure

### Table of Contents

1. Introduction
2. Project Overview
3. Step-by-Step Instructions
   1. Setting Up the Environment in Azure
   2. Deploying Snort IDS
   3. Configuring Snort Rules
   4. Simulating Brute-Force SSH Attack
   5. Monitoring and Logging Snort Alerts
4. Conclusion

---

### Introduction

This project demonstrates the deployment and configuration of a **Snort Intrusion Detection System (IDS)** on an Ubuntu server in Azure. The setup involves monitoring traffic and detecting attacks simulated from a Kali Linux attacker machine targeting an Ubuntu victim machine.

The goal of the project is to understand how Snort IDS detects and logs malicious activities, such as brute-force attacks, in a controlled environment.

---

### Project Overview

- **Snort IDS Server**: Ubuntu Server running Snort IDS.
- **Target Machine**: Ubuntu Server (victim) configured with vulnerable services.
- **Attacker Machine**: Kali Linux VM used for simulating attacks.
- **Azure Environment**: All virtual machines are hosted on Azure within the same virtual network.

#### Skills Covered

- Deploying virtual machines on Azure.
- Installing and configuring Snort IDS.
- Simulating brute-force attacks with **Hydra** from Kali Linux.
- Monitoring and analyzing security alerts generated by Snort.

---

### Step-by-Step Instructions

#### Setting Up the Environment in Azure

1. **Create a Resource Group**: 
   - Sign in to [Azure Portal](https://portal.azure.com).
   - Navigate to Resource Groups and create a new resource group called `CyberSecProjectRG`.
  
2. **Create a Virtual Network (VNet)**:
   - Create a virtual network (`CyberSecVNet`) with an address space of `10.0.0.0/16`.
   - Add a subnet (`DefaultSubnet`) with an address range of `10.0.0.0/24`.

3. **Deploy the Ubuntu Target Machine**:
   - Create an Ubuntu Server VM (`TargetVM`) in the `CyberSecVNet`.
   - Ensure the VM has SSH enabled (port 22).

4. **Deploy the Snort IDS Server**:
   - Create another Ubuntu Server VM (`SnortIDSVM`) in the same virtual network.

5. **Deploy the Kali Linux Attacker Machine**:
   - Deploy a Kali Linux VM (`KaliAttackerVM`) in the same virtual network for attack simulation.

#### Deploying Snort IDS

1. **Update the System**:
   - On the Snort IDS server (`SnortIDSVM`), update the system:

     ```bash
     sudo apt update && sudo apt upgrade -y
     ```

2. **Install Required Dependencies**:

   ```bash
   sudo apt install -y build-essential libpcap-dev libpcre3-dev libdumbnet-dev bison flex zlib1g-dev liblzma-dev openssl libssl-dev pkg-config
   ```

3. **Install DAQ (Data Acquisition Library)**:

   ```bash
   wget https://www.snort.org/downloads/snort/daq-2.0.7.tar.gz
   tar -xzvf daq-2.0.7.tar.gz
   cd daq-2.0.7
   ./configure && make && sudo make install
   ```

4. **Install Snort**:

   ```bash
   wget https://www.snort.org/downloads/snort/snort-2.9.20.tar.gz
   tar -xzvf snort-2.9.20.tar.gz
   cd snort-2.9.20
   ./configure --enable-sourcefire && make && sudo make install
   ```

5. **Create Directories for Snort**:

   ```bash
   sudo mkdir -p /etc/snort/rules /var/log/snort /usr/local/lib/snort_dynamicrules
   sudo touch /etc/snort/rules/white_list.rules /etc/snort/rules/black_list.rules
   sudo chown -R snort:snort /etc/snort /var/log/snort
   ```

6. **Download Snort Rules**:

   Download Snort rules appropriate for your Snort version from the official website or use community rules.

   Example:

   ```bash
   wget https://www.snort.org/downloads/community/community-rules.tar.gz
   sudo tar -xzvf community-rules.tar.gz -C /etc/snort/rules
   ```

7. **Configure `snort.conf`**:

   - Open the Snort configuration file:

     ```bash
     sudo nano /etc/snort/snort.conf
     ```

   - Ensure the following line exists to point to the correct rules path:

     ```bash
     var RULE_PATH /etc/snort/rules
     ```

   - Include the required rule files:

     ```bash
     include $RULE_PATH/local.rules
     include $RULE_PATH/community.rules
     ```

8. **Test Snort Configuration**:

   Run Snort in test mode to ensure there are no errors:

   ```bash
   sudo snort -T -c /etc/snort/snort.conf
   ```

#### Configuring Snort Rules

1. **Create or Modify Local Rules**:

   - Open the `local.rules` file to add custom detection rules:

     ```bash
     sudo nano /etc/snort/rules/local.rules
     ```

   - Example rule to detect SSH brute-force attempts:

     ```bash
     alert tcp any any -> $HOME_NET 22 (msg:"SSH Brute Force Attempt Detected"; flags:S; threshold:type threshold, track by_src, count 3, seconds 60; sid:1000001; rev:1;)
     ```

   - Save and exit the file.

2. **Include `local.rules` in the Configuration**:

   Ensure that `local.rules` is included in the `snort.conf` file:

   ```bash
   include $RULE_PATH/local.rules
   ```

3. **Verify and Reload Snort**:

   Test the configuration again after adding rules:

   ```bash
   sudo snort -T -c /etc/snort/snort.conf
   ```

   If successful, Snort will load without any errors.

#### Simulating Brute-Force SSH Attack

1. **Run Snort in IDS Mode**:

   Start Snort to monitor traffic and log alerts:

   ```bash
   sudo snort -A console -q -c /etc/snort/snort.conf -i eth0
   ```

2. **Simulate SSH Brute-Force Attack** from Kali Linux:

   Use Hydra to simulate a brute-force attack on SSH:

   ```bash
   hydra -l saalim -P /usr/share/wordlists/rockyou.txt -t 4 ssh://10.0.0.4
   ```

   Replace `10.0.0.4` with the IP address of the target machine.

#### Monitoring and Logging Snort Alerts

1. **Check for Alerts in Console**:

   If Snort is running in console mode (`-A console`), you will see real-time alerts as the attack is detected.

2. **Check Log Files**:

   If Snort is logging to files, check the alert log:

   ```bash
   sudo tail -f /var/log/snort/alert
   ```

3. **Example Alert**:

   If the brute-force attack is detected, you should see an alert similar to:

   ```
   [**] [1:1000001:1] SSH Brute Force Attempt Detected [**]
   {TCP} <source_ip>:<source_port> -> <target_ip>:22
   ```

---

### Conclusion

In this project, we successfully deployed Snort IDS on an Ubuntu server in Azure, configured detection rules, and simulated a brute-force attack using Hydra from a Kali Linux VM. Snort successfully detected the attack and generated alerts based on the rules configured.

The project demonstrates the power of Snort as an IDS for monitoring network traffic and detecting suspicious activities in real-time. This setup provides a foundation for further exploration into network security and IDS technologies.
